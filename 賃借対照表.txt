SELECT
    am.account_type,
    am.sort_order,
    am.account_code,
    am.account_name,
    SUM(gl.debit)  AS total_debit,
    SUM(gl.credit) AS total_credit,
    SUM(gl.debit - gl.credit) AS balance
FROM gl_journal_header gh
JOIN gl_journal_line gl
    ON gl.journal_id = gh.journal_id
JOIN account_master am
    ON am.account_code = gl.account_code
WHERE gh.posted = 1
  AND gh.journal_date <= @as_of_date
GROUP BY
    am.account_type,
    am.sort_order,
    am.account_code,
    am.account_name
ORDER BY
    am.account_type,
    am.sort_order,
    am.account_code;